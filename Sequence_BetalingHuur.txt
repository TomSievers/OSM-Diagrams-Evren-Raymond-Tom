@startuml

participant PoleSession as pSession
participant "p:Payment" as p
participant IDataBaseConnector as Database
participant "IBank" as b
participant "newOpenPayment: OpenPayment" as pOP
participant "existingOpenPayment: OpenPayment" as eOP

===New Invoice==
activate pSession
pSession -> p: sendInvoice(reservation: Reservation): void
activate p
	p -> p: reservationToInvoice(reservation: Reservation): newOpenPayment: OpenPayment
	activate p	
		create pOP
		p -> pOP: OpenPayment(amount: unsigned long long)
		p -> Database: addOpenPayment(newOpenPayment: OpenPayment)
	deactivate p
	p -> b: recieveInvoice(id: unsigned long long, bankAccountNumber: string, amount:float): void
deactivate p
===Periodic Status Check==
p -> Database: handlingPayments = getOpenPayment(): OpenPayment[0..*]
loop existingOpenPayment:handlingPayments
	p -> eOP: dataBaseState = getState(): Invoicestatus
	p -> eOP: paymentId = getId(): unsigned long long
	p -> b: bankState = getInvoiceStatus(paymentId: unsigned long long): Invoicestatus
	opt dataBaseState != bankState
		p->eOP: setStatus(newStatus: Invoicestatus): void
		p->Database: editOpenPayment(existingOpenPayment: OpenPayment): void
	end
end

@enduml